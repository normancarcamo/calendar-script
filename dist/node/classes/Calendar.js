'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _Observer2=require('./Observer');var _Observer3=_interopRequireDefault(_Observer2);var _Year=require('./Year');var _Year2=_interopRequireDefault(_Year);var _Month=require('./Month');var _Month2=_interopRequireDefault(_Month);var _Months=require('../helpers/Months');var _Months2=_interopRequireDefault(_Months);var _WeekDay=require('../helpers/WeekDay');var _WeekDay2=_interopRequireDefault(_WeekDay);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var Calendar=function(_Observer){_inherits(Calendar,_Observer);_createClass(Calendar,null,[{key:'EVENTS',get:function get(){return{EACH_YEAR:'each:year',EACH_YEAR_ADDED:'each:year:added'};}}]);function Calendar(){_classCallCheck(this,Calendar);var _this=_possibleConstructorReturn(this,(Calendar.__proto__||Object.getPrototypeOf(Calendar)).call(this));_this.today=new Date(Date.now());_this.years={};return _this;}_createClass(Calendar,[{key:'addYear',value:function addYear(year,callback){if(!arguments.length){throw new Error('Invalid arguments');};if(typeof year!=='number'||!/(^19\d{1,2}$|^2\d{3,3}$)/g.test(year)){throw new Error('Invalid year');};this.years[year]=new _Year2.default(year);this.emit(Calendar.EVENTS.EACH_YEAR,this.years[year]);var result=this.build(this.years[year]);this.emit(Calendar.EVENTS.EACH_YEAR_ADDED,this.years[year]);if(callback){if(typeof callback!=="function"){throw new Error('Invalid callback');}else{callback(this.years);};};return this;}},{key:'build',value:function build(year,callback){if(!(year instanceof _Year2.default)){throw new Error('Invalid year');};year.months=new _Months2.default(year.leap).map(function(month,index){year.emit(_Year2.default.EVENTS.EACH_MONTH,month);var END_OF_MONTH=new Date(year.key,index+1,0).getDate();var daysInYear=month.summary.start;var daysInCollection=0;while(daysInCollection<END_OF_MONTH){var key=daysInCollection+1;var date=new Date(year.key,index,key,0,0,0,0);var monthZero=index+1<10?'0'+(index+1):index+1;var dayZero=key<10?'0'+key:key;var day=new _WeekDay2.default(date.getDay());day.key=key;day.date=[date,year.key+'-'+monthZero+'-'+dayZero];day.summary.indexInWeek=date.getDay();day.summary.indexInYear=daysInYear;if(key===1){day.summary.firstInMonth=true;}if(key===END_OF_MONTH){day.summary.lastInMonth=true;}month.emit(_Month2.default.EVENTS.EACH_DAY,day);month.addDay(day,_Month2.default.EVENTS.EACH_DAY_ADDED);daysInYear++;daysInCollection++;}year.addMonth(month,_Year2.default.EVENTS.EACH_MONTH_ADDED);return month;});if(callback){if(typeof callback!=="function"){throw new Error('Invalid callback');}else{callback(year);};};return year;}},{key:'filter',value:function filter(options,callback){if(!options||(typeof options==='undefined'?'undefined':_typeof(options))!=='object'){throw new Error('Invalid options');};if(!Object.keys(options).length){throw new Error('Invalid options');};if(!('year'in options)&&!('from'in options)){throw new Error('Invalid options');};if('year'in options){if(typeof options.year!=='number'){throw new Error('Invalid year');};if(!/(^19\d{1,2}$|^2\d{3,3}$)/g.test(options.year)){throw new Error('Invalid year');};var _year=options.year||this.today.getFullYear();this.addYear(_year);}else{if('from'in options){if(typeof options.from!=='number'){throw new Error('Invalid from');};if(!/(^19\d{1,2}$|^2\d{3,3}$)/g.test(options.from)){throw new Error('Invalid from');};this.range={from:options.from||1900,to:options.to||this.today.getFullYear()};for(var year=this.range.from;year<=this.range.to;year++){this.addYear(year);};};};if(callback){if(typeof callback!=="function"){throw new Error('Invalid callback');}else{callback(year);};};return this;}},{key:'filterDaysPerWeek',value:function filterDaysPerWeek(days){if(!arguments.length){throw new Error('Invalid arguments');};if(Object.prototype.toString.call(days)!=='[object Array]'){throw new Error('Invalid days');};if(!days.length){throw new Error('Invalid days');};return days.reduce(function(target,day,index){if(index%7===0){target.push(days.slice(index,index+7));}return target;},[]);}},{key:'daysWithPadding',value:function daysWithPadding(month){if(!arguments.length){throw new Error('Invalid arguments');};if(!(month instanceof _Month2.default)){throw new Error('Invalid month');};var firstday=month.days[0];var lastday=month.days[month.days.length-1];var prevl=firstday.summary.indexInWeek-0;var nextl=42-lastday.key-prevl;var year=firstday.date[0].getFullYear();var prev=[];var next=[];for(var p=prevl;p--;){var date=new Date(year,month.key-1,p===0?0:-p);var key=date.getDate();var monthZero=date.getMonth()+1<10?'0'+(date.getMonth()+1):date.getMonth()+1;var dayZero=key<10?'0'+key:key;var day=new _WeekDay2.default(date.getDay());day.key=key;day.date=[date,date.getFullYear()+'-'+monthZero+'-'+dayZero];if(key===lastday.date[0].getDate()){day.summary.lastInMonth=true;}day.summary.indexInWeek=date.getDay();day.summary.prev=true;day.summary.padding=true;prev.push(day);}for(var n=lastday.key+1;n<=lastday.key+nextl;n++){var _date=new Date(year,month.key-1,n);var _key=_date.getDate();var _monthZero=_date.getMonth()+1<10?'0'+(_date.getMonth()+1):_date.getMonth()+1;var _dayZero=_key<10?'0'+_key:_key;var _day=new _WeekDay2.default(_date.getDay());_day.key=_key;_day.date=[_date,_date.getFullYear()+'-'+_monthZero+'-'+_dayZero];if(_key===1){_day.summary.firstInMonth=true;}_day.summary.indexInWeek=_date.getDay();_day.summary.next=true;_day.summary.padding=true;next.push(_day);}return{days:prev.concat(month.days).concat(next),prev:prevl,next:nextl};}}]);return Calendar;}(_Observer3.default);exports.default=Calendar;