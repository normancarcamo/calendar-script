'use strict';var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}(function(){'use strict';var Calendar=function(){var Observer=function(){function Observer(){_classCallCheck(this,Observer);this.actions={};}_createClass(Observer,[{key:'on',value:function on(name,action){if(!name){throw new Error('Parameter "name" must be passed as a string');};if(!action){throw new Error('Parameter "action" must be passed as a function');};if(!this.actions[name]){this.actions[name]={notify:action};}else{this.actions[name].notify=action;};return this;}},{key:'off',value:function off(name,callback){if(!name){throw new Error('Parameter "name" must be passed as a string');};if(this.actions[name]){delete this.actions[name];};if(callback){callback();};return this;}},{key:'offAll',value:function offAll(callback){var _this=this;Object.keys(this.actions).forEach(function(name){if(_this.actions[name]){delete _this.actions[name];};});if(callback){callback();};return this;}},{key:'emit',value:function emit(name,data){if(!name){throw new Error('Parameter "name" must be passed as a string');};if(this.actions[name]){this.actions[name].notify.apply(this,Array.prototype.slice.call(arguments).slice(1));};return this;}},{key:'emitAll',value:function emitAll(callback){var _this2=this;Object.keys(this.actions).forEach(function(name){if(_this2.actions[name]){_this2.actions[name].notify.call(_this2);};});if(callback){callback();};return this;}}]);return Observer;}();var Day=function(_Observer){_inherits(Day,_Observer);function Day(key,name,summary){_classCallCheck(this,Day);var _this3=_possibleConstructorReturn(this,(Day.__proto__||Object.getPrototypeOf(Day)).call(this));if(typeof key!=='number'){throw new Error('Invalid "key" for Day');};if(!name||typeof name!=='string'){throw new Error('Invalid "name" for Day');};if(summary){_this3.summary=summary;};_this3.key=key;_this3.name=name?name.toLowerCase():'';_this3.letter=_this3.name.charAt(0);_this3.abbr=_this3.name.substring(0,3);return _this3;}return Day;}(Observer);var WeekDay=function(){_createClass(WeekDay,null,[{key:'DAYS',get:function get(){return{SUNDAY:0,MONDAY:1,TUESDAY:2,WEDNESDAY:3,THURSDAY:4,FRIDAY:5,SATURDAY:6};}}]);function WeekDay(index){_classCallCheck(this,WeekDay);if(!arguments.length){throw new Error('Invalid index');};if(typeof index!=='number'){throw new Error('Invalid index');};if(index>6){throw new Error('Invalid index');};return[new Day(0,'Sunday',{weekend:true,lastInWeek:true}),new Day(1,'Monday',{workday:true,firstInWeek:true}),new Day(2,'Tuesday',{workday:true}),new Day(3,'Wednesday',{workday:true}),new Day(4,'Thursday',{workday:true}),new Day(5,'Friday',{workday:true}),new Day(6,'Saturday',{weekend:true})][index];}return WeekDay;}();var Months=function Months(leap){_classCallCheck(this,Months);if(!arguments.length){throw new Error('Invalid leap');};if(typeof leap!=='boolean'){throw new Error('Invalid leap');};var summary={January:{days:31,start:1,end:31},February:{days:28,start:32,end:31+28},March:{days:31,start:60,end:59+31},April:{days:30,start:91,end:90+30},May:{days:31,start:121,end:120+31},June:{days:30,start:152,end:151+30},July:{days:31,start:182,end:181+31},August:{days:31,start:213,end:212+31},September:{days:30,start:244,end:243+30},October:{days:31,start:274,end:273+31},November:{days:30,start:305,end:304+30},December:{days:31,start:335,end:334+31}};return Object.keys(summary).reduce(function(target,key,index){var month=new Month(index+1,key,summary[key]);if(leap){if(index===1){month.summary.days++;month.summary.end++;}else if(index>=2){month.summary.days++;month.summary.start++;month.summary.end++;};};target.push(month);return target;},[]);};var Month=function(_Observer2){_inherits(Month,_Observer2);_createClass(Month,null,[{key:'EVENTS',get:function get(){return{EACH_DAY:'each:day',EACH_DAY_ADDED:'each:day:added'};}}]);function Month(key,name,summary){_classCallCheck(this,Month);var _this4=_possibleConstructorReturn(this,(Month.__proto__||Object.getPrototypeOf(Month)).call(this));if(typeof key!=='number'){throw new Error('Invalid "key" for Month');};if(!name||typeof name!=='string'){throw new Error('Invalid "name" for Month');};if(summary){_this4.summary=summary;};_this4.key=key;_this4.name=name?name.toLowerCase():'';_this4.letter=_this4.name.charAt(0);_this4.abbr=_this4.name.substring(0,3);_this4.days=[];return _this4;}_createClass(Month,[{key:'addDay',value:function addDay(day,action,callback){if(!arguments.length){throw new Error('Invalid arguments');};if(!(day instanceof Day)){throw new Error('Invalid day');};if(action){if(typeof action!=='string'){throw new Error('Invalid action');}else{this.emit(action,day);};};this.days.push(day);if(callback){if(typeof callback!=="function"){throw new Error('Invalid callback');}else{callback(this.days);};};return this;}}]);return Month;}(Observer);var Year=function(_Observer3){_inherits(Year,_Observer3);_createClass(Year,null,[{key:'EVENTS',get:function get(){return{EACH_MONTH:'each:month',EACH_MONTH_ADDED:'each:month:added'};}}]);function Year(key){_classCallCheck(this,Year);var _this5=_possibleConstructorReturn(this,(Year.__proto__||Object.getPrototypeOf(Year)).call(this));if(!/(^19\d{1,2}$|^2\d{3,3}$)/g.test(key)){throw new Error('Invalid "key" for Year');};_this5.months=[];_this5.key=key;_this5.leap=new Date(key,2,0).getDate()>28;_this5.days=_this5.leap?366:365;return _this5;}_createClass(Year,[{key:'addMonth',value:function addMonth(month,action,callback){if(!arguments.length){throw new Error('Invalid arguments');};if(!(month instanceof Month)){throw new Error('Invalid month');};if(action){if(typeof action!=='string'){throw new Error('Invalid action');}else{this.emit(action,month);};};this.months.push(month);if(callback){if(typeof callback!=="function"){throw new Error('Invalid callback');}else{callback(this.months);};};return this;}}]);return Year;}(Observer);var Calendar=function(_Observer4){_inherits(Calendar,_Observer4);_createClass(Calendar,null,[{key:'EVENTS',get:function get(){return{EACH_YEAR:'each:year',EACH_YEAR_ADDED:'each:year:added'};}}]);function Calendar(){_classCallCheck(this,Calendar);var _this6=_possibleConstructorReturn(this,(Calendar.__proto__||Object.getPrototypeOf(Calendar)).call(this));_this6.today=new Date(Date.now());_this6.years={};return _this6;}_createClass(Calendar,[{key:'addYear',value:function addYear(year,callback){if(!arguments.length){throw new Error('Invalid arguments');};if(typeof year!=='number'||!/(^19\d{1,2}$|^2\d{3,3}$)/g.test(year)){throw new Error('Invalid year');};this.years[year]=new Year(year);this.emit(Calendar.EVENTS.EACH_YEAR,this.years[year]);var result=this.build(this.years[year]);this.emit(Calendar.EVENTS.EACH_YEAR_ADDED,this.years[year]);if(callback){if(typeof callback!=="function"){throw new Error('Invalid callback');}else{callback(this.years);};};return this;}},{key:'build',value:function build(year,callback){if(!(year instanceof Year)){throw new Error('Invalid year');};year.months=new Months(year.leap).map(function(month,index){year.emit(Year.EVENTS.EACH_MONTH,month);var END_OF_MONTH=new Date(year.key,index+1,0).getDate();var daysInYear=month.summary.start;var daysInCollection=0;while(daysInCollection<END_OF_MONTH){var key=daysInCollection+1;var date=new Date(year.key,index,key,0,0,0,0);var monthZero=index+1<10?'0'+(index+1):index+1;var dayZero=key<10?'0'+key:key;var day=new WeekDay(date.getDay());day.key=key;day.date=[date,year.key+'-'+monthZero+'-'+dayZero];day.summary.indexInWeek=date.getDay();day.summary.indexInYear=daysInYear;if(key===1){day.summary.firstInMonth=true;};if(key===END_OF_MONTH){day.summary.lastInMonth=true;};month.emit(Month.EVENTS.EACH_DAY,day);month.addDay(day,Month.EVENTS.EACH_DAY_ADDED);daysInYear++;daysInCollection++;};year.addMonth(month,Year.EVENTS.EACH_MONTH_ADDED);return month;});if(callback){if(typeof callback!=="function"){throw new Error('Invalid callback');}else{callback(year);};};return year;}},{key:'filter',value:function filter(options,callback){if(!options||(typeof options==='undefined'?'undefined':_typeof(options))!=='object'){throw new Error('Invalid options');};if(!Object.keys(options).length){throw new Error('Invalid options');};if(!('year'in options)&&!('from'in options)){throw new Error('Invalid options');};if('year'in options){if(typeof options.year!=='number'){throw new Error('Invalid year');};if(!/(^19\d{1,2}$|^2\d{3,3}$)/g.test(options.year)){throw new Error('Invalid year');};var _year=options.year||this.today.getFullYear();this.addYear(_year);}else{if('from'in options){if(typeof options.from!=='number'){throw new Error('Invalid from');};if(!/(^19\d{1,2}$|^2\d{3,3}$)/g.test(options.from)){throw new Error('Invalid from');};this.range={from:options.from||1900,to:options.to||this.today.getFullYear()};for(var year=this.range.from;year<=this.range.to;year++){this.addYear(year);};};};if(callback){if(typeof callback!=="function"){throw new Error('Invalid callback');}else{callback(year);};};return this;}},{key:'filterDaysPerWeek',value:function filterDaysPerWeek(days){if(!arguments.length){throw new Error('Invalid arguments');};if(Object.prototype.toString.call(days)!=='[object Array]'){throw new Error('Invalid days');};if(!days.length){throw new Error('Invalid days');};return days.reduce(function(target,day,index){if(index%7===0){target.push(days.slice(index,index+7));};return target;},[]);}},{key:'daysWithPadding',value:function daysWithPadding(month){if(!arguments.length){throw new Error('Invalid arguments');};if(!(month instanceof Month)){throw new Error('Invalid month');};var firstday=month.days[0];var lastday=month.days[month.days.length-1];var prevl=firstday.summary.indexInWeek-0;var nextl=42-lastday.key-prevl;var year=firstday.date[0].getFullYear();var prev=[];var next=[];for(var p=prevl;p--;){var date=new Date(year,month.key-1,p===0?0:-p);var key=date.getDate();var monthZero=date.getMonth()+1<10?'0'+(date.getMonth()+1):date.getMonth()+1;var dayZero=key<10?'0'+key:key;var day=new WeekDay(date.getDay());day.key=key;day.date=[date,date.getFullYear()+'-'+monthZero+'-'+dayZero];if(key===lastday.date[0].getDate()){day.summary.lastInMonth=true;};day.summary.indexInWeek=date.getDay();day.summary.prev=true;day.summary.padding=true;prev.push(day);};for(var n=lastday.key+1;n<=lastday.key+nextl;n++){var _date=new Date(year,month.key-1,n);var _key=_date.getDate();var _monthZero=_date.getMonth()+1<10?'0'+(_date.getMonth()+1):_date.getMonth()+1;var _dayZero=_key<10?'0'+_key:_key;var _day=new WeekDay(_date.getDay());_day.key=_key;_day.date=[_date,_date.getFullYear()+'-'+_monthZero+'-'+_dayZero];if(_key===1){_day.summary.firstInMonth=true;};_day.summary.indexInWeek=_date.getDay();_day.summary.next=true;_day.summary.padding=true;next.push(_day);}return{days:prev.concat(month.days).concat(next),prev:prevl,next:nextl};}}]);return Calendar;}(Observer);return Calendar;}();if(typeof module!=="undefined"&&typeof module.exports!=="undefined"){module.exports=Calendar;}else{if(typeof define==="function"&&define.amd){define([],function(){return Calendar;});}else{window.Calendar=Calendar;};};})();